{{- if and .Values.crossplane_providerconfig.aws.enabled .Values.cloud.aws.services.apps.kafka_strimzi.enabled -}}
{{- if .Values.cloud.aws.services.apps.kafka_strimzi.kafka.enabled -}}
apiVersion: helm.crossplane.io/v1beta1
kind: Release
metadata:
  name: {{ .Values.global.app.name }}-eks-kafka
  namespace: {{ .Release.Namespace }}
  labels:
    appName: {{ .Values.global.app.name }}
spec:
  forProvider:
    chart:
      name: clappit-kafka
      repository: "oci://registry-1.docker.io/bitnamicharts"
      version: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.image_version }}
    namespace: kafka
    values:
      kafka:
        name: {{ .Values.global.app.name }}-eks-kafka
        namespace: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.namespace }}
        version: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.version }}
        replicas: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.replicas }}
        authenticationType: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.authenticationType }}
        replicaFetchMaxBytes: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.replicaFetchMaxBytes }}
        storageVolumesSize: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.storageVolumesSize }}
        user:
          name: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.user_name }}
      zookeeper:
        replicas: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.zookeeper.replicas }}
        storageType: persistent-claim
        storageSize: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.zookeeper.storageSize }}
  providerConfigRef:
    name: {{ .Values.global.app.name }}-eks-helm
{{- end }}
---
apiVersion: helm.crossplane.io/v1beta1
kind: Release
metadata:
  name: {{ .Values.global.app.name }}-eks-kafkaop
  namespace: {{ .Release.Namespace }}
  labels:
    appName: {{ .Values.global.app.name }}
spec:
  forProvider:
    chart:
      name: strimzi-kafka-operator
      repository: "https://strimzi.io/charts"
    namespace: {{ .Values.cloud.aws.services.apps.kafka_strimzi.kafka.namespace }}
  providerConfigRef:
    name: {{ .Values.global.app.name }}-eks-helm
{{- end }}